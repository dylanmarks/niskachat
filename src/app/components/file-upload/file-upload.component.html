<div class="file-upload-container">
  <div class="upload-header">
    <h2>📁 Upload FHIR Bundle</h2>
    <p class="upload-subtitle">
      Upload a FHIR Bundle JSON file to view patient data offline
    </p>
  </div>

  <!-- Upload Area -->
  <div
    class="upload-zone"
    [class.drag-over]="isDragOver"
    [class.has-file]="uploadStatus.fileName"
    (click)="fileInput.click()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <input
      #fileInput
      type="file"
      accept=".json"
      (change)="onFileSelected($event)"
      style="display: none"
    />

    <!-- Default State -->
    <div
      *ngIf="!uploadStatus.fileName && !uploadStatus.isUploading"
      class="upload-prompt"
    >
      <div class="upload-icon">📁</div>
      <h3>Drag & Drop FHIR Bundle Here</h3>
      <p>
        or
        <span class="browse-link">browse files</span>
      </p>
      <small>Supports .json files up to 10MB</small>
    </div>

    <!-- File Selected -->
    <div
      *ngIf="uploadStatus.fileName && !uploadStatus.isUploading"
      class="file-info"
    >
      <div class="file-icon">📄</div>
      <h3>{{ uploadStatus.fileName }}</h3>
      <p>Ready to process</p>
      <button
        class="process-button"
        (click)="processFile(); $event.stopPropagation()"
      >
        Process Bundle
      </button>
    </div>

    <!-- Processing -->
    <div *ngIf="uploadStatus.isUploading" class="processing-state">
      <div class="spinner"></div>
      <h3>Processing FHIR Bundle...</h3>
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="uploadStatus.progress"
        ></div>
      </div>
      <p>{{ uploadStatus.progress }}% complete</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="uploadStatus.error" class="error-card">
    <div class="error-icon">⚠️</div>
    <h3>Upload Error</h3>
    <p>{{ uploadStatus.error }}</p>
    <button
      class="retry-button"
      (click)="resetUpload(); $event.stopPropagation()"
    >
      Try Again
    </button>
  </div>

  <!-- Success State -->
  <div *ngIf="uploadStatus.success" class="success-card">
    <div class="success-icon">✅</div>
    <h3>Bundle Processed Successfully!</h3>
    <p>{{ uploadStatus.fileName }} has been processed.</p>

    <div class="extracted-resources">
      <h4>Extracted Resources:</h4>
      <div class="resource-counts">
        <div
          class="resource-count"
          *ngIf="uploadStatus.extractedResources.patients.length > 0"
        >
          <span class="count">
            {{ uploadStatus.extractedResources.patients.length }}
          </span>
          <span class="label">Patient(s)</span>
        </div>
        <div
          class="resource-count"
          *ngIf="uploadStatus.extractedResources.conditions.length > 0"
        >
          <span class="count">
            {{ uploadStatus.extractedResources.conditions.length }}
          </span>
          <span class="label">Condition(s)</span>
        </div>
        <div
          class="resource-count"
          *ngIf="uploadStatus.extractedResources.observations.length > 0"
        >
          <span class="count">
            {{ uploadStatus.extractedResources.observations.length }}
          </span>
          <span class="label">Observation(s)</span>
        </div>
        <div
          class="resource-count"
          *ngIf="
            uploadStatus.extractedResources.medicationRequests.length > 0
          "
        >
          <span class="count">
            {{ uploadStatus.extractedResources.medicationRequests.length }}
          </span>
          <span class="label">Medication(s)</span>
        </div>
      </div>
    </div>

    <button
      class="new-upload-button"
      (click)="resetUpload(); $event.stopPropagation()"
    >
      Upload Another Bundle
    </button>
  </div>

  <!-- Current Context Info -->
  <div *ngIf="context && !context.patient" class="context-info">
    <div class="info-icon">ℹ️</div>
    <p>
      <strong>Offline Mode:</strong>
      Upload a FHIR Bundle to view patient data without connecting to a FHIR
      server.
    </p>

    <!-- Example Data Buttons -->
    <div class="example-data-section">
      <h4>Or try example data:</h4>
      <div class="example-buttons">
        <button
          class="example-button"
          (click)="loadExampleData('johnsmith')"
          [disabled]="uploadStatus.isUploading"
        >
          📊 Load John Smith Data
        </button>
        <button
          class="example-button"
          (click)="loadExampleData('maria')"
          [disabled]="uploadStatus.isUploading"
        >
          📊 Load Maria Johnson Data
        </button>
      </div>
    </div>
  </div>
</div>